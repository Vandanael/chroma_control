<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#121214" />
  
  <!-- PWA Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Chroma Control" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="application-name" content="Chroma Control" />
  
  <!-- Emp√™cher le pull-to-refresh sur mobile -->
  <meta name="overscroll-behavior" content="none" />
  <style>
    /* Emp√™cher le pull-to-refresh */
    body {
      overscroll-behavior-y: none;
      -webkit-overflow-scrolling: touch;
    }
    html {
      overscroll-behavior: none;
    }
  </style>
  
  <!-- Security Headers (Relaxed for Development) -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline' 'unsafe-eval';
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    font-src 'self' https://fonts.gstatic.com data:;
    img-src 'self' data:;
    connect-src 'self' ws://localhost:* http://localhost:*;
    base-uri 'self';
    form-action 'self';
  ">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
  <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">
  
  <title>Chroma Control</title>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      touch-action: none;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
      background-color: var(--color-bg-deep);
      font-family: var(--font-family);
    }


    /* START SCREEN - Minimaliste Organique */
    .screen-overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      pointer-events: auto;
      z-index: 900;
      background: var(--color-bg-deep);
      transition: opacity var(--duration-slow) var(--ease-out);
      
      /* Gradient radial TR√àS subtil pour ne pas g√™ner les contrastes */
      background-image: 
        radial-gradient(
          ellipse at center 40%, 
          rgba(var(--color-active-rgb), 0.03) 0%, 
          transparent 60%
        );
    }

    .screen-overlay.fade-out {
      opacity: 0;
      pointer-events: none;
    }

    .screen-inner {
      max-width: 600px;
      width: 90%;
      padding: 0;
      background: transparent;
      
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      
      height: 100vh;
      position: relative;
      padding-top: max(8vh, 60px);
      padding-bottom: max(6vh, 48px, var(--safe-area-bottom));
      box-sizing: border-box;
      
      /* Espacement vertical fixe pour garantir la distribution */
      gap: 0;
    }

    .screen-title {
      font-size: var(--text-3xl);
      font-weight: var(--font-black);
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: #FFFFFF;
      text-align: center;
      margin-bottom: 0;
      line-height: 1.1;
      
      /* Glow subtil avec couleur active */
      text-shadow: 
        0 0 20px var(--color-active-glow),
        0 0 40px var(--color-active-glow);
      
      animation: fadeUp var(--duration-slower) var(--ease-out);
    }

    .screen-subtitle {
      font-size: var(--text-lg);
      font-weight: var(--font-semibold);
      text-transform: lowercase;
      letter-spacing: 0.08em;
      text-align: center;
      color: rgba(255, 255, 255, 0.8);
      line-height: 1.4;
      
      animation: fadeUp var(--duration-slower) var(--ease-out) 0.1s backwards;
    }

    /* Orbe Anim√© - Style Organique */
    .orb-container {
      position: relative;
      width: 200px;
      height: 200px;
      margin: 0 auto;
      flex-shrink: 0;
      
      animation: float 4s ease-in-out infinite;
    }

    #planet-animation-container {
      position: absolute;
      width: 100%;
      height: 100%;
      left: 0;
      top: 0;
      z-index: 1;
      pointer-events: none;
      
      /* Glow autour de l'orbe */
      filter: drop-shadow(0 0 30px var(--color-active-glow-strong));
    }
    
    #planet-animation-container canvas {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
    }


    /* Bouton Principal (START) */
    .cta-button {
      min-width: 280px;
      min-height: var(--touch-hero);
      padding: var(--space-lg) var(--space-2xl);
      
      /* Forme blob organique */
      border-radius: var(--radius-blob-1);
      
      /* Fond sombre avec bordure color√©e */
      background: rgba(255, 255, 255, 0.05);
      color: var(--color-active);
      border: 3px solid var(--color-active);
      
      /* Typo */
      font-family: var(--font-family);
      font-size: var(--text-xl);
      font-weight: var(--font-black);
      letter-spacing: 0.1em;
      text-transform: uppercase;
      
      /* Glow color√© autour */
      box-shadow: 
        0 0 30px var(--color-active-glow),
        0 0 60px var(--color-active-glow),
        0 8px 24px rgba(0, 0, 0, 0.4);
      
      cursor: pointer;
      transition: 
        transform var(--duration-fast) var(--ease-out),
        box-shadow var(--duration-fast) var(--ease-out),
        background var(--duration-fast) var(--ease-out);
      
      animation: scaleIn var(--duration-slow) var(--ease-bounce) 0.3s backwards;
    }

    .cta-button:hover {
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 
        0 0 40px var(--color-active-glow),
        0 0 80px var(--color-active-glow),
        0 12px 32px rgba(0, 0, 0, 0.5);
    }

    .cta-button:active {
      transform: scale(0.95);
      background: rgba(255, 255, 255, 0.12);
      box-shadow: 
        0 0 20px var(--color-active-glow),
        0 0 40px var(--color-active-glow),
        0 4px 16px rgba(0, 0, 0, 0.3);
    }

    /* S√©lecteurs de Couleur (Orbes) */
    .color-selector {
      display: flex;
      gap: var(--space-lg);
      justify-content: center;
      animation: fadeUp var(--duration-slow) var(--ease-out) 0.2s backwards;
    }

    .color-button {
      width: var(--touch-comfortable);
      height: var(--touch-comfortable);
      padding: 0;
      
      border-radius: var(--radius-full);
      border: 3px solid transparent;
      
      background: currentColor;
      
      cursor: pointer;
      transition: 
        transform var(--duration-normal) var(--ease-bounce),
        border-color var(--duration-normal) var(--ease-out),
        box-shadow var(--duration-normal) var(--ease-out);
      
      /* Label cach√© visuellement mais accessible */
      font-size: 0;
      overflow: hidden;
      text-indent: -9999px;
    }

    .color-button:hover {
      transform: scale(1.05);
    }

    .color-button:active {
      transform: scale(0.95);
    }

    .color-button.selected {
      transform: scale(1.15);
      border-color: var(--color-text-primary);
      box-shadow: 
        0 0 30px currentColor,
        0 4px 16px rgba(0, 0, 0, 0.3);
    }

    /* Couleurs sp√©cifiques */
    .color-button[data-color="CYAN"] {
      color: var(--color-cyan);
    }

    .color-button[data-color="GREEN"] {
      color: var(--color-green);
    }

    .color-button[data-color="AMBER"] {
      color: var(--color-amber);
    }



    /* Footer Credits */
    .screen-footer {
      text-align: center;
      color: rgba(255, 255, 255, 0.6);
      font-size: var(--text-sm);
      font-weight: var(--font-medium);
      letter-spacing: 0.05em;
      
      animation: fadeIn var(--duration-slower) var(--ease-out) 0.4s backwards;
    }

    .screen-footer a {
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: color var(--duration-normal) var(--ease-out);
      font-weight: var(--font-semibold);
    }

    .screen-footer a:hover {
      color: var(--color-active);
    }

    /* ===== SETTINGS TOGGLES (Simplifi√©s) ===== */
    .settings-bar {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-bottom: max(3vh, 24px);
      animation: fadeUp var(--duration-slow) var(--ease-out) 0.35s backwards;
      flex-wrap: wrap;
      max-width: 100%;
      padding: 0 16px;
    }

    .setting-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      user-select: none;
      padding: 4px;
      transition: opacity var(--duration-normal) var(--ease-out);
    }

    .setting-toggle:hover {
      opacity: 0.8;
    }

    .setting-toggle .icon {
      font-size: 20px;
      line-height: 1;
      transition: transform var(--duration-fast) var(--ease-out);
    }

    .setting-toggle:hover .icon {
      transform: scale(1.1);
    }

    .setting-toggle .label {
      font-family: var(--font-family);
      font-size: 12px;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.7);
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    /* Switch iOS-like compact */
    .toggle-switch {
      position: relative;
      width: 44px;
      height: 24px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      transition: all var(--duration-normal) var(--ease-out);
      flex-shrink: 0;
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      transition: all var(--duration-normal) var(--ease-out);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .setting-toggle.active .toggle-switch {
      background: var(--color-active);
    }

    .setting-toggle.active .toggle-switch::after {
      left: 22px;
    }

    /* Language Toggle simplifi√© */
    .lang-toggle {
      display: flex;
      gap: 2px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 2px;
    }

    .lang-option {
      padding: 4px 10px;
      border-radius: 10px;
      font-size: 11px;
      font-weight: 700;
      transition: all var(--duration-normal) var(--ease-out);
      color: rgba(255, 255, 255, 0.5);
      min-width: 32px;
      text-align: center;
    }

    .lang-option.active {
      background: var(--color-active);
      color: white;
    }

    /* Light Mode - Color√© */
    html[data-theme="light"] {
      --color-bg-deep: #f0f4f8;
      --color-text-primary: #1a1a1a;
    }

    html[data-theme="light"] .screen-overlay {
      background: linear-gradient(
        135deg,
        rgba(var(--color-active-rgb), 0.12) 0%,
        rgba(var(--color-active-rgb), 0.04) 50%,
        #f0f4f8 100%
      );
      background-image: 
        radial-gradient(
          ellipse at center 40%, 
          rgba(var(--color-active-rgb), 0.15) 0%, 
          transparent 60%
        );
    }

    html[data-theme="light"] .screen-title {
      color: var(--color-text-primary);
      text-shadow: 
        0 0 20px rgba(var(--color-active-rgb), 0.3),
        0 0 40px rgba(var(--color-active-rgb), 0.2);
    }

    html[data-theme="light"] .screen-subtitle {
      color: rgba(0, 0, 0, 0.7);
    }

    html[data-theme="light"] .cta-button {
      background: rgba(var(--color-active-rgb), 0.1);
      border-color: var(--color-active);
      color: var(--color-active);
    }

    html[data-theme="light"] .cta-button:hover {
      background: rgba(var(--color-active-rgb), 0.15);
    }

    html[data-theme="light"] .setting-toggle .label {
      color: rgba(0, 0, 0, 0.7);
    }

    html[data-theme="light"] .toggle-switch {
      background: rgba(0, 0, 0, 0.15);
    }

    html[data-theme="light"] .lang-toggle {
      background: rgba(0, 0, 0, 0.08);
    }

    html[data-theme="light"] .lang-option {
      color: rgba(0, 0, 0, 0.5);
    }

    html[data-theme="light"] .screen-footer {
      color: rgba(0, 0, 0, 0.5);
    }

    html[data-theme="light"] .screen-footer a {
      color: rgba(0, 0, 0, 0.7);
    }
  </style>
</head>
<body>

  <!-- START SCREEN -->
  <div id="start-screen" class="screen-overlay" style="display: flex;">
    <div class="screen-inner">
      <!-- Zone haute : Titre -->
      <div style="margin-bottom: max(4vh, 32px);">
        <h1 id="start-title" class="screen-title">CHROMA<br>CONTROL</h1>
      </div>

      <!-- Zone centrale : Orbe + Subtitle -->
      <div style="
        display: flex; 
        flex-direction: column; 
        align-items: center; 
        gap: max(3vh, 24px);
        margin-bottom: max(5vh, 40px);
      ">
        <div class="orb-container">
          <div id="planet-animation-container"></div>
        </div>
        <p class="screen-subtitle">
          expand your color
        </p>
      </div>

      <!-- Spacer flexible pour pousser le contenu suivant vers le bas -->
      <div style="flex: 1; min-height: 20px;"></div>

      <!-- Zone basse : S√©lection couleur + Bouton START -->
      <div style="
        display: flex; 
        flex-direction: column; 
        align-items: center; 
        gap: max(4vh, 32px);
        margin-bottom: max(3vh, 24px);
      ">
        <!-- Color Selection (Orbes) -->
        <div class="color-selector">
          <button 
            id="btn-color-cyan" 
            class="color-button" 
            data-color="CYAN"
            aria-label="Cyan">
            CYAN
          </button>
          <button 
            id="btn-color-green" 
            class="color-button" 
            data-color="GREEN"
            aria-label="Green">
            GREEN
          </button>
          <button 
            id="btn-color-amber" 
            class="color-button" 
            data-color="AMBER"
            aria-label="Amber">
            AMBER
          </button>
        </div>

        <!-- Bouton START (CTA Principal) -->
        <button id="btn-start" class="cta-button">
          JOUER
        </button>
      </div>

      <!-- Settings Toggles -->
      <div class="settings-bar">
        <!-- Leaderboard Toggle -->
        <div class="setting-toggle" id="toggle-leaderboard" data-setting="leaderboard">
          <span class="icon">üèÜ</span>
          <span class="label">Leaderboard</span>
          <span class="toggle-switch"></span>
        </div>

        <!-- Language Toggle FR/EN -->
        <div class="setting-toggle" id="toggle-language" data-setting="language">
          <span class="icon">üåê</span>
          <div class="lang-toggle">
            <span class="lang-option active" data-lang="FR">FR</span>
            <span class="lang-option" data-lang="EN">EN</span>
          </div>
        </div>

        <!-- Dark Mode Toggle -->
        <div class="setting-toggle" id="toggle-darkmode" data-setting="darkmode">
          <span class="icon" id="darkmode-icon">üåô</span>
          <span class="label">Dark</span>
          <span class="toggle-switch"></span>
        </div>
      </div>

      <!-- Footer Credits -->
      <div class="screen-footer">
        Made by <a href="https://github.com/Vandanael/" target="_blank" rel="noopener noreferrer">Vandanael</a>
      </div>

      <!-- Bouton Debug (vider cache) -->
      <button id="btn-debug-cache" style="
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: rgba(255, 68, 102, 0.2);
        border: 2px solid rgba(255, 68, 102, 0.5);
        color: #FF4466;
        font-size: 24px;
        cursor: pointer;
        z-index: 1000;
        transition: all 0.2s ease;
      " title="Vider le cache (Debug)">
        üóëÔ∏è
      </button>
    </div>
  </div>

  <!-- GAME CONTAINER (PixiJS Canvas) -->
  <div id="game-container" style="
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000000;
    z-index: 100;
  "></div>

  <script type="module" src="/src/main.ts"></script>
</body>
</html>
